<!DOCTYPE html>
<html>

<head>
  <script src="static/jquery-3.4.1.min.js"></script>
  <script src="static/popper.min.js"></script>
  <script src="static/bootstrap.min.js"></script>
  <script src="static/colorpicker.min.js"></script>

  <link rel="stylesheet" type="text/css" href="static/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="static/colorpicker.min.css">
</head>

<body>
  <style>
    .inl-bl {
      display: inline-block;
    }

    .colorpicker-2x .colorpicker-saturation {
      width: 200px;
      height: 200px;
    }

    .colorpicker-2x .colorpicker-hue,
    .colorpicker-2x .colorpicker-alpha {
      width: 30px;
      height: 200px;
    }

    .colorpicker-2x .colorpicker-color,
    .colorpicker-2x .colorpicker-color div {
      height: 30px;
    }
  </style>
  <div class="container-fluid" id="main_body">
    <div class="row alert alert-success">
      <div class="col">
        <a class="" data-toggle="collapse" href="#collapse_env" role="button" aria-expanded="false"
          aria-controls="collapse_env">
          <h4>Temperature / Humidity</h4>
        </a>
      </div>
      <div class="col">
        <h4>30.5 F / 80%</h4>
      </div>
    </div>
    <div class="row">
      <div class="collapse" id="collapse_env">
        <div class="card-body">
          <p>Temperatures: 40.32, 23.34, 32.00</p>
          <p>Humidity: </p>
        </div>
      </div>
    </div>
  </div>

  <div id="colorpicker" class="inl-bl">
  </div>
  <div>
    <button id="submitColorBtn">Submit</button>
    <button id="offColorBtn">Off</button>
  </div>

  <script type="text/javascript">
    function submitColor() {
      var color = $("#colorpicker").data().colorpicker.color.toRGB();
      var url = "/ledchange?red=" + color.r + "&blue=" + color.b +
        "&green=" + color.g + "&alpha=" + color.a +
        "&seat=0";
      $.get(url);
    }

    function turnOffLed() {
      var url = "/ledchange?red=0&blue=0&green=0&alpha=0";
      $.get(url);
    }

    $(document).ready(function () {
      $.getJSON("/api/setting", function (data) {
        data.leds.forEach((led) => {
          $("#main_body").append(
            `<div class="row alert alert-primary">
              <div class="col">
                <h4>${led.name}</h4>
              </div>
              <div class="col">
                <input type="color" id="led_${led.index}"
                        class="form-control form-control-lg seat_color"
                        data-index="${led.index}">
              </div>
            </div>
            `);
        });
      });

      $("#main_body").append(
        `<div class="row alert alert-primary">
              <div class="col">
                <h4>Test led</h4>
              </div>
              <div class="col">
                <input type="color" id="led_0"
                        class="form-control form-control-lg seat_color"
                        data-index="0">
              </div>
            </div>
            `);


      $('#main_body').on('input', '.seat_color', function (event) {
        var color = event.target.value;
        if (color.startsWith('#')) {
          color = color.substring(2);
        }
        var seat = event.target.getAttribute("data-index");
        var url = `/api/ledchange?seat=${seat}&color=${color}`;
        // $.get(url, (data) => {
        //   alert(data.color);
        // });

        $.post("/api/led", { seat: seat, color: color }).done(data => {
          alert(data.color);
        });
      });

      $('#colorpicker').colorpicker({
        container: true,
        inline: true,
        customClass: 'colorpicker-2x',
        sliders: {
          saturation: {
            maxLeft: 200,
            maxTop: 200
          },
          hue: {
            maxTop: 200
          },
          alpha: {
            maxTop: 200
          }
        }
      });
      $('#submitColorBtn').on('click', submitColor);
      $('#offColorBtn').on('click', turnOffLed);
    });
  </script>

</body>

</html>